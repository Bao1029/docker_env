# bclinux

## 102

```bash
nmcli con add type ethernet con-name eno1 ifname eno1  ipv4.method manual ipv4.addresses 172.21.6.102/24 ipv4.gateway 172.21.6.254 ipv4.dns 172.21.1.1
nmcli connection up eno1

nmcli con del em1
nmcli con del em2
nmcli con del em3
nmcli con del em4
nmcli con del ib0
nmcli con del ib1
nmcli con del '有线连接 1'
nmcli con del '有线连接 2'
nmcli con del '有线连接 3'
nmcli con del '有线连接 4'

grubby --bootloader-probe
# grub2

# https://access.redhat.com/solutions/3089
awk -F\' /^menuentry/{print\$2} /etc/grub2-efi.cfg
# BigCloud Enterprise Linux (4.19.25-200.el7.bclinux.x86_64) 7.6 (Core)
# BigCloud Enterprise Linux (3.10.0-957.el7.x86_64) 7.6 (Core)
# BigCloud Enterprise Linux (0-rescue-a83d55f0cf184e2aa5949e0d5b154bbf) 7.6 (Core)

grub2-set-default 0

cat /boot/grub2/grubenv | grep saved
# saved_entry=1

grub2-mkconfig -o /boot/efi/EFI/bclinux/grub.cfg

# crack the license
mv /etc/yum/pluginconf.d/license-manager.conf /etc/yum/pluginconf.d/license-manager.conf.bak

```

## 105
```bash
nmcli con add type ethernet con-name eno1 ifname eno1  ipv4.method manual ipv4.addresses 172.21.6.105/24 ipv4.gateway 172.21.6.254 ipv4.dns 172.21.1.1
nmcli connection up eno1

nmcli con del em1
nmcli con del em2
nmcli con del em3
nmcli con del em4
nmcli con del ib0
nmcli con del ib1
nmcli con del '有线连接 1'
nmcli con del '有线连接 2'
nmcli con del '有线连接 3'
nmcli con del '有线连接 4'

grubby --bootloader-probe
# grub2

# https://access.redhat.com/solutions/3089
awk -F\' /^menuentry/{print\$2} /etc/grub2-efi.cfg
# BigCloud Enterprise Linux (4.19.25-200.el7.bclinux.x86_64) 7.6 (Core)
# BigCloud Enterprise Linux (3.10.0-957.el7.x86_64) 7.6 (Core)
# BigCloud Enterprise Linux (0-rescue-a83d55f0cf184e2aa5949e0d5b154bbf) 7.6 (Core)

grub2-set-default 0

cat /boot/grub2/grubenv | grep saved
# saved_entry=1

grub2-mkconfig -o /boot/efi/EFI/bclinux/grub.cfg

# crack the license
mv /etc/yum/pluginconf.d/license-manager.conf /etc/yum/pluginconf.d/license-manager.conf.bak

```
old
![](imgs/2021-03-14-20-02-49.png)

# Cx6 driver
https://www.mellanox.com/products/infiniband-drivers/linux/mlnx_ofed
```bash
cd ~/down

yum install -y createrepo
yum install -y python-devel pciutils kernel-devel-4.19.25-200.el7.bclinux.x86_64 gcc
yum -y update

mount -o ro,loop MLNX_OFED_LINUX-5.2-2.2.0.0-bclinux7.6-x86_64.iso /mnt

/mnt/mlnx_add_kernel_support.sh -m /mnt --make-tgz


```

# rancher

## on 105
```bash
yum -y install docker
systemctl enable --now docker
systemctl disable --now firewalld
sed -i 's/enforcing/disabled/g' /etc/selinux/config; setenforce 0

# https://rancher.com/docs/rancher/v2.0-v2.4/en/quick-start-guide/deployment/quickstart-manual-setup/
docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher:v2.4.5

# https://172.21.6.105

docker run -d --privileged --restart=unless-stopped --net=host -v /etc/kubernetes:/etc/kubernetes -v /var/run:/var/run rancher/rancher-agent:v2.4.5 --server https://172.21.6.105 --token 2twnln5kmq8g859rvl4x5qd6mmn2gr4mpml86p2frzb6lgj6dmdw26 --ca-checksum bb9cbef84ab2a2df2da2595e2469a16c1f396ad8f9d472fc1b573b2ede5a5b70 --etcd --controlplane --worker

mkdir -p ~/down
cd ~/down

export http_proxy="http://127.0.0.1:18801"
export https_proxy=${http_proxy}

wget https://releases.rancher.com/cli2/v2.4.5/rancher-linux-amd64-v2.4.5.tar.gz
tar -xzf rancher-linux-amd64-v2.4.5.tar.gz --strip-components=2 -C /usr/local/bin/

curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
mv kubectl /usr/local/bin/

mkdir -p ~/.kube/
vi ~/.kube/config

```

## on 102

```bash
yum -y install docker
systemctl enable --now docker
systemctl disable --now firewalld

docker run -d --privileged --restart=unless-stopped --net=host -v /etc/kubernetes:/etc/kubernetes -v /var/run:/var/run rancher/rancher-agent:v2.4.5 --server https://172.21.6.105 --token 2twnln5kmq8g859rvl4x5qd6mmn2gr4mpml86p2frzb6lgj6dmdw26 --ca-checksum bb9cbef84ab2a2df2da2595e2469a16c1f396ad8f9d472fc1b573b2ede5a5b70 --etcd --controlplane --worker


```

# multus

```bash
cd ~/down
wget https://raw.githubusercontent.com/k8snetworkplumbingwg/multus-cni/master/images/multus-daemonset.yml

cat multus-daemonset.yml | kubectl apply -f -

```

# Share device plugin
https://github.com/mellanox/k8s-rdma-shared-dev-plugin
```bash


```

# gpu operator

```bash


```

# reference

- https://www.azurew.com/kubernetes/6252.html